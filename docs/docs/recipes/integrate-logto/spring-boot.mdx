---
sidebar_label: Spring Boot
---

import signOutRedirectUriFigure from './assets/spring-boot-post-sign-out-redirect-uri.png';
import redirectUriFigure from './assets/spring-boot-redirect-uri.png';
import AppNote from './fragments/_app-note.mdx';
import ConfigureRedirectUri from './fragments/_configure-redirect-uri.mdx';
import GradleBuild from './fragments/_spring-boot-gradle-build.md';
import HomeController from './fragments/_spring-boot-home-controller.md';
import HomePage from './fragments/_spring-boot-home-page.md';
import LoginConfiguration from './fragments/_spring-boot-login-configuration.md';
import LogoutConfiguration from './fragments/_spring-boot-logout-configuration.md';
import LogoutHandler from './fragments/_spring-boot-logout-handler.md';
import SpringSecurityConfiguration from './fragments/_spring-security-configuration.md';

# Spring Boot

<AppNote type="Traditional web" />

Your web app may run on the server-side using Spring Boot framework.
For now, you need to integrate Logto in Spring Boot manually.
This article guides you on how to finish it step by step.
And we use Java, Gradle, Spring MVC and [Thymeleaf](https://www.thymeleaf.org/) to take the example.

## Start a Spring Boot project

With [Spring Initializr](https://start.spring.io/), you can quickly start a Spring Boot project.
Follow the options below:

- Gradle Project
- Language: Java
- Spring Boot: 2.7.2

Generate and open the project.

## Add dependencies

Add the dependencies to your Gradle project build file `build.gradle`:

<GradleBuild />

:::note

Since Spring Boot and Spring Security have built-in support for both OAuth 2 and OIDC,
you DO NOT need to add additional libraries from Logto to integrate.

See [Spring Security and OpenID Connect](https://www.baeldung.com/spring-security-openid-connect),
[Spring Security Architecture](https://spring.io/guides/topicals/spring-security-architecture),
and [OAuth2 - Spring Security](https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html)
for more details.

:::

## Configure Spring Security

Spring Security makes it easy to configure your application for authentication with OIDC providers such as Logto.

Use an `application.yml` file (instead of the default `application.properties`) to configure the OAuth2 client and provider.

<SpringSecurityConfiguration />

## Sign-in

### Configure Redirect URI

<ConfigureRedirectUri
  figureSrc={redirectUriFigure}
  redirectUri="http://localhost:3000/login/oauth2/code/logto"
/>

### Configure Spring Security

To enable Logto user sign-in, you need to provide an instance of `SecurityFilterChain` (as a Spring Bean) and add the `@EnableWebSecurity` annotation.

Use `authorizationRequestResolver` to enable [PKCE](https://oauth.net/2/pkce/) extension for increased safety and add parameter `prompt=consent`.

:::note

As the `offline_access` scope has been provided above, we should add the parameter `prompt=consent`;
otherwise, the `offline_access` scope will be ignored, and no refresh token will be returned.

:::

<LoginConfiguration />

### Implement sign-in route

A user can visit the route `/oauth2/authorization/logto` (e.g. `http://localhost:3000/oauth2/authorization/logto`) to sign in.
Spring Security will use the `spring.security.oauth2.client` configuration provided above to handle user sign-in automatically.

Let's try this sign-in link on your web application page.

Add a home page template file:

<HomePage />

Add a controller to render the view:

<HomeController />

Run your Spring Boot web application, visit the home page [http://localhost:3000/](http://localhost:3000/), click the _Sign in_ link on it, and it will redirect to the Logto sign-in page.

Provide your credentials, and once authenticated, it will redirect you back to the home page with a message that shows "Signed in".

## Sign out

### Configure Post Sign-out Redirect URI

Let&apos;s switch to the Application details page of Admin Console in this section.
Add a Post Sign-out Redirect URI `http://localhost:3000` and click &quot;Save Changes&quot;.

<img alt="Redirect URI in Admin Console" src={signOutRedirectUriFigure} width="600px" />

Once your user signs out, it will redirect them to the Post Sign-out Redirect URI, e.g. your web application home page.

### Configure Spring Security

To enable Logto user sign-out, you need to extend the `SecurityContextLogoutHandler` class
to redirect users to your Logto sign-out endpoint `/oidc/session/end` (e.g. `http://localhost:3001/oidc/session/end`)
and then redirect back to your application.

Add a sign-out handler:

<LogoutHandler />

Enable sign-out and configure its path and handler.

<LogoutConfiguration />

When sign-out is enabled, Spring Security will sign the user out of your application and clear the session automatically by default.

### Implement sign-out route

As configuration above, a user can visit the route `/sign-out` (e.g. `http://localhost:3000/sign-out`) to sign out.
Spring Security will use the `logoutHandler` to handle user sign-out.

Let's try this sign-out link on your web application page.

Add the sign-out link on the home page template file added above:

```html
<!-- path/to/project/src/main/resources/templates/index.html -->
<!-- ... -->
<div sec:authorize="isAuthenticated()">
  <p>Signed in</p>
  <a th:href="@{/sign-out}">Sign out</a>
</div>
<!-- ... -->
```

Run your Spring Boot web application,
visit the home page [http://localhost:3000/](http://localhost:3000/),
click the _Sign out_ link on it,
and it will redirect to the Logto end-session endpoint.

Once Logto end-session process is done,
it will redirect you back to Post Sign-out Redirect URI configured above,
i.e. the home page with a "Sign in" link.

## Profile

TODO
