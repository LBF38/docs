"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[26203],{49613:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return g}});var a=n(59496);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),g=o,m=d["".concat(s,".").concat(g)]||d[g]||c[g]||r;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},39842:function(e,t,n){n.d(t,{Z:function(){return i}});n(59496);var a=n(45924),o="tabItem_rXKf",r=n(4637);function i(e){var t=e.children,n=e.hidden,i=e.className;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.Z)(o,i),hidden:n,children:t})}},16833:function(e,t,n){n.d(t,{Z:function(){return z}});var a=n(59496),o=n(45924),r=n(70632),i=n(5734),l=n(37401),s=n(80587),u=n(32131);function p(e){return function(e){var t,n;return null!=(t=null==(n=a.Children.map(e,(function(e){if(!e||(0,a.isValidElement)(e)&&(t=e.props)&&"object"==typeof t&&"value"in t)return e;var t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?t:[]}(e).map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}function c(e){var t=e.values,n=e.children;return(0,a.useMemo)((function(){var e=null!=t?t:p(n);return function(e){var t=(0,s.l)(e,(function(e,t){return e.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function d(e){var t=e.value;return e.tabValues.some((function(e){return e.value===t}))}function g(e){var t=e.queryString,n=void 0!==t&&t,o=e.groupId,r=(0,i.k6)(),s=function(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:n,groupId:o});return[(0,l._X)(s),(0,a.useCallback)((function(e){if(s){var t=new URLSearchParams(r.location.search);t.set(s,e),r.replace(Object.assign({},r.location,{search:t.toString()}))}}),[s,r])]}function m(e){var t,n,o,r,i=e.defaultValue,l=e.queryString,s=void 0!==l&&l,p=e.groupId,m=c(e),h=(0,a.useState)((function(){return function(e){var t,n=e.defaultValue,a=e.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!d({value:n,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+a.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var o=null!=(t=a.find((function(e){return e.default})))?t:a[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:i,tabValues:m})})),k=h[0],f=h[1],N=g({queryString:s,groupId:p}),v=N[0],b=N[1],y=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:p}.groupId),n=(0,u.Nk)(t),o=n[0],r=n[1],[o,(0,a.useCallback)((function(e){t&&r.set(e)}),[t,r])]),z=y[0],w=y[1],T=function(){var e=null!=v?v:z;return d({value:e,tabValues:m})?e:null}();return(0,a.useLayoutEffect)((function(){T&&f(T)}),[T]),{selectedValue:k,selectValue:(0,a.useCallback)((function(e){if(!d({value:e,tabValues:m}))throw new Error("Can't select invalid tab value="+e);f(e),b(e),w(e)}),[b,w,m]),tabValues:m}}var h=n(15800),k="tabList_p_G8",f="tabItem_prV4",N=n(4637);function v(e){var t=e.className,n=e.block,a=e.selectedValue,i=e.selectValue,l=e.tabValues,s=[],u=(0,r.o5)().blockElementScrollPositionUntilNextRender,p=function(e){var t=e.currentTarget,n=s.indexOf(t),o=l[n].value;o!==a&&(u(t),i(o))},c=function(e){var t,n=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":var a,o=s.indexOf(e.currentTarget)+1;n=null!=(a=s[o])?a:s[0];break;case"ArrowLeft":var r,i=s.indexOf(e.currentTarget)-1;n=null!=(r=s[i])?r:s[s.length-1]}null==(t=n)||t.focus()};return(0,N.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t),children:l.map((function(e){var t=e.value,n=e.label,r=e.attributes;return(0,N.jsx)("li",Object.assign({role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:function(e){return s.push(e)},onKeyDown:c,onClick:p},r,{className:(0,o.Z)("tabs__item",f,null==r?void 0:r.className,{"tabs__item--active":a===t}),children:null!=n?n:t}),t)}))})}function b(e){var t=e.lazy,n=e.children,o=e.selectedValue,r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){var i=r.find((function(e){return e.props.value===o}));return i?(0,a.cloneElement)(i,{className:"margin-top--md"}):null}return(0,N.jsx)("div",{className:"margin-top--md",children:r.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==o})}))})}function y(e){var t=m(e);return(0,N.jsxs)("div",{className:(0,o.Z)("tabs-container",k),children:[(0,N.jsx)(v,Object.assign({},e,t)),(0,N.jsx)(b,Object.assign({},e,t))]})}function z(e){var t=(0,h.Z)();return(0,N.jsx)(y,Object.assign({},e),String(t))}},85689:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return p},default:function(){return h},frontMatter:function(){return u},metadata:function(){return c},toc:function(){return g}});var a=n(665),o=n(40151),r=(n(59496),n(49613)),i=n(39842),l=n(16833),s=["components"],u={sidebar_position:4},p="Integrate Organizations with your app",c={unversionedId:"docs/recipes/organizations/integration",id:"docs/recipes/organizations/integration",title:"Integrate Organizations with your app",description:"This document assumes you have already integrated Logto with your app.",source:"@site/docs/docs/recipes/organizations/integration.mdx",sourceDirName:"docs/recipes/organizations",slug:"/docs/recipes/organizations/integration",permalink:"/next/docs/recipes/organizations/integration",draft:!1,editUrl:"https://github.com/logto-io/docs/tree/master/docs/docs/recipes/organizations/integration.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"docsSidebar",previous:{title:"Impact on end-user sign-in experience",permalink:"/next/docs/recipes/organizations/impact-on-end-users"},next:{title:"\ud83d\udc64 User profiles",permalink:"/next/docs/recipes/user-profile/"}},d={},g=[{value:"Get organization IDs of the current user",id:"get-organization-ids-of-the-current-user",level:2},{value:"Get organization roles",id:"get-organization-roles",level:3},{value:"Fetch access token for an organization",id:"fetch-access-token-for-an-organization",level:2},{value:"Step 1: Add parameters to the authentication request",id:"step-1-add-parameters-to-the-authentication-request",level:3},{value:"Step 2: Fetch the organization token",id:"step-2-fetch-the-organization-token",level:3},{value:"Example",id:"example",level:3},{value:"Verify organization tokens",id:"verify-organization-tokens",level:2}],m={toc:g};function h(e){var t=e.components,n=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"integrate-organizations-with-your-app"},"Integrate Organizations with your app"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"This document assumes you have already ",(0,r.kt)("a",{parentName:"p",href:"/next/docs/recipes/integrate-logto/"},"integrated Logto with your app"),".")),(0,r.kt)("p",null,"In your app, you may want to show a list of organizations that the user is a member of, and perform actions in the context of an organization. Let's see how to do that."),(0,r.kt)("h2",{id:"get-organization-ids-of-the-current-user"},"Get organization IDs of the current user"),(0,r.kt)("p",null,"Logto extends the standard ",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html"},"OpenID Connect")," protocol to allow your app to get the organization info from the user. There are two ways to do that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If you are using a Logto SDK with Organizations support, you can add the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organizations")," scope to ",(0,r.kt)("inlineCode",{parentName:"li"},"scopes")," parameter of the configuration object. Usually the SDK will have an enum for this scope, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"UserScope.Organizations")," in ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/logto-io/js"},"Logto JS SDKs"),"."),(0,r.kt)("li",{parentName:"ul"},"For other cases, you need to add the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organizations")," scope to the ",(0,r.kt)("inlineCode",{parentName:"li"},"scope")," parameter of the SDK config (or auth request).")),(0,r.kt)(l.Z,{groupId:"sdk",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const logto = new LogtoClient({\n  // ...\n  scopes: [UserScope.Organizations],\n});\n"))),(0,r.kt)(i.Z,{value:"react",label:"React",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"<LogtoProvider\n  config={{\n    // ...\n    scopes: [UserScope.Organizations],\n  }}\n></LogtoProvider>\n"))),(0,r.kt)(i.Z,{value:"others",label:"Others",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n};\n")))),(0,r.kt)("p",null,"Once the user finishes the authentication flow, you can get the organization info from the ",(0,r.kt)("inlineCode",{parentName:"p"},"idToken"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Use JavaScript as an example\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // A string array of organization IDs\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"organizations")," field (claim) will also be included in response from the ",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo"},"UserInfo endpoint"),"."),(0,r.kt)("h3",{id:"get-organization-roles"},"Get organization roles"),(0,r.kt)("p",null,"To get all organization roles of the current user:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If you are using a Logto SDK with Organizations support, you can add the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organization_roles")," scope to ",(0,r.kt)("inlineCode",{parentName:"li"},"scopes")," parameter of the configuration object. Usually the SDK will have an enum for this scope, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"UserScope.OrganizationRoles")," in ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/logto-io/js"},"Logto JS SDKs"),"."),(0,r.kt)("li",{parentName:"ul"},"For other cases, you need to add the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organization_roles")," scope to the ",(0,r.kt)("inlineCode",{parentName:"li"},"scope")," parameter of the SDK config (or auth request).")),(0,r.kt)("p",null,"Then you can get the organization roles from the ",(0,r.kt)("inlineCode",{parentName:"p"},"idToken"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Use JavaScript as an example\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organization_roles); // A string array of organization roles\n")),(0,r.kt)("p",null,"Each string in the array is in the format of ",(0,r.kt)("inlineCode",{parentName:"p"},"organization_id:role_id"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"org_123:admin")," means the user has the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," role in the organization with ID ",(0,r.kt)("inlineCode",{parentName:"p"},"org_123"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"organization_roles")," field (claim) will also be included in response from the ",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo"},"UserInfo endpoint"),"."),(0,r.kt)("h2",{id:"fetch-access-token-for-an-organization"},"Fetch access token for an organization"),(0,r.kt)("p",null,"To perform actions in the context of an organization, the user needs to be granted an access token for that organization (organization token). The organization token is a JWT token that contains the organization ID and the user's permissions (scopes) in the organization."),(0,r.kt)("h3",{id:"step-1-add-parameters-to-the-authentication-request"},"Step 1: Add parameters to the authentication request"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If you are using a Logto SDK with Organizations support, you can add the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organization_token")," scope to ",(0,r.kt)("inlineCode",{parentName:"li"},"scopes")," parameter of the configuration object, the same way as ",(0,r.kt)("a",{parentName:"li",href:"#get-organization-ids-of-the-current-user"},"Get organization IDs of the current user"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Logto SDK with Organizations support will automatically handle the rest of the configuration."))),(0,r.kt)("li",{parentName:"ul"},"For other cases, you need to add the ",(0,r.kt)("inlineCode",{parentName:"li"},"offline_access")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organizations")," scopes to the ",(0,r.kt)("inlineCode",{parentName:"li"},"scope")," parameter and the ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:resource:organizations")," resource to the ",(0,r.kt)("inlineCode",{parentName:"li"},"resource")," parameter of the SDK config (or auth request).",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ",(0,r.kt)("inlineCode",{parentName:"li"},"offline_access")," is required to get the ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token")," that can be used to fetch organization tokens.")))),(0,r.kt)(l.Z,{groupId:"sdk",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const logto = new LogtoClient({\n  // ...\n  scopes: [UserScope.Organizations],\n});\n"))),(0,r.kt)(i.Z,{value:"react",label:"React",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"<LogtoProvider\n  config={{\n    // ...\n    scopes: [UserScope.Organizations],\n  }}\n></LogtoProvider>\n"))),(0,r.kt)(i.Z,{value:"others",label:"Others",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n  resource: 'urn:logto:resource:organizations',\n};\n")))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"urn:logto:resource:organizations")," resource is a special resource that represents the organization template.")),(0,r.kt)("h3",{id:"step-2-fetch-the-organization-token"},"Step 2: Fetch the organization token"),(0,r.kt)("p",null,"Logto extends the standard ",(0,r.kt)("inlineCode",{parentName:"p"},"refresh_token")," grant type to allow your app to fetch organization tokens."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If you are using a Logto SDK with Organizations support, you can call the ",(0,r.kt)("inlineCode",{parentName:"li"},"getOrganizationToken()")," method (or ",(0,r.kt)("inlineCode",{parentName:"li"},"getOrganizationTokenClaims()")," method) of the SDK."),(0,r.kt)("li",{parentName:"ul"},"For other cases, you need to call the token endpoint with the following parameters:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"grant_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"client_id"),": The app ID the user used to authenticate."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token"),": The ",(0,r.kt)("inlineCode",{parentName:"li"},"refresh_token")," you got from the authentication flow."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"organization_id"),": The ID of the organization you want to get the token for."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scope")," (optional): The scopes you want to grant to the user in the organization. If not specified, the authorization server will try to grant the same scopes as the authentication flow.")))),(0,r.kt)(l.Z,{groupId:"sdk",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const token = await logto.getOrganizationToken('org_123');\n"))),(0,r.kt)(i.Z,{value:"react",label:"React",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const App = () => {\n  const { getOrganizationToken } = useLogto();\n\n  const getToken = async () => {\n    const token = await getOrganizationToken('org_123');\n  };\n\n  return <button onClick={getToken}>Get organization token</button>;\n};\n"))),(0,r.kt)(i.Z,{value:"others",label:"Others",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Use JavaScript as an example\n\nconst params = new URLSearchParams();\n\nparams.append('grant_type', 'refresh_token');\nparams.append('client_id', 'YOUR_CLIENT_ID');\nparams.append('refresh_token', 'REFRESH_TOKEN');\nparams.append('organization_id', 'org_123');\n\nconst response = await fetch('https://YOUR_LOGTO_ENDPOINT/oidc/token', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n  },\n  body: params,\n});\n")))),(0,r.kt)("p",null,"The response will be in the same format as the ",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint"},"standard token endpoint"),", and the ",(0,r.kt)("inlineCode",{parentName:"p"},"access_token")," is the organization token in JWT format."),(0,r.kt)("p",null,"Besides regular claims of an access token, the organization token also contains the following claims:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"aud"),": The audience of the organization token is ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:organization:{organization_id}"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"scope"),": The scopes granted to the user in the organization with space as delimiter.")),(0,r.kt)("h3",{id:"example"},"Example"),(0,r.kt)("p",null,"A good example can beat a thousand words. Assume our organization template has the following setup:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Permissions: ",(0,r.kt)("inlineCode",{parentName:"li"},"read:logs"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"write:logs"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"read:users"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"write:users"),"."),(0,r.kt)("li",{parentName:"ul"},"Roles: ",(0,r.kt)("inlineCode",{parentName:"li"},"admin"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"member"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"admin")," role has all permissions."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"member")," role has ",(0,r.kt)("inlineCode",{parentName:"li"},"read:logs")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"read:users")," permissions.")))),(0,r.kt)("p",null,"And the user has the following setup:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Organization IDs: ",(0,r.kt)("inlineCode",{parentName:"li"},"org_1"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"org_2"),"."),(0,r.kt)("li",{parentName:"ul"},"Organization roles: ",(0,r.kt)("inlineCode",{parentName:"li"},"org_1:admin"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"org_2:member"),".")),(0,r.kt)("p",null,"In the Logto SDK config (or auth request), we set up other things properly, and added the following scopes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:scope:organizations")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"openid")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"offline_access")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"read:logs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"write:logs"))),(0,r.kt)("p",null,"Now, when the user finishes the authentication flow, we can get the organization IDs from the ",(0,r.kt)("inlineCode",{parentName:"p"},"idToken"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Use JavaScript as an example\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // ['org_1', 'org_2']\n")),(0,r.kt)("p",null,"If we want to get the organization tokens:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Use JavaScript as an example\nconst org1Token = await logto.getOrganizationTokenClaims('org_1');\nconst org2Token = await logto.getOrganizationTokenClaims('org_2');\n\nconsole.log(org1Token.aud); // 'urn:logto:organization:org_1'\nconsole.log(org1Token.scope); // 'read:logs write:logs'\nconsole.log(org2Token.aud); // 'urn:logto:organization:org_2'\nconsole.log(org2Token.scope); // 'read:logs'\n\nconst org3Token = await logto.getOrganizationTokenClaims('org_3'); // Error: User is not a member of the organization\n")),(0,r.kt)("p",null,"Explanation:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"org_1"),", the user has the ",(0,r.kt)("inlineCode",{parentName:"li"},"admin")," role, so the organization token should have all available permissions (scopes)."),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"org_2"),", the user has the ",(0,r.kt)("inlineCode",{parentName:"li"},"member")," role, so the organization token should have ",(0,r.kt)("inlineCode",{parentName:"li"},"read:logs")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"read:users")," permissions (scopes).")),(0,r.kt)("p",null,"Since we only requested ",(0,r.kt)("inlineCode",{parentName:"p"},"read:logs")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"write:logs"),' scopes in the authentication flow, the organization tokens have been "downscoped" accordingly, resulting in the intersection of the requested scopes and the available scopes.'),(0,r.kt)("h2",{id:"verify-organization-tokens"},"Verify organization tokens"),(0,r.kt)("p",null,"Once the app gets an organization token, it can use the token in the same way as a regular access token, e.g. call the APIs with the token in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization")," header in the format of ",(0,r.kt)("inlineCode",{parentName:"p"},"Bearer {token}"),"."),(0,r.kt)("p",null,"In your API, you can verify the organization token which is similar to ",(0,r.kt)("a",{parentName:"p",href:"/docs/recipes/protect-your-api/#validate-the-authorization-token"},"Proctect your API"),". Main differences:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Unlike access tokens for API resources, a user CANNOT get an organization token if the user is not a member of the organization."),(0,r.kt)("li",{parentName:"ul"},"The audience of the organization token is ",(0,r.kt)("inlineCode",{parentName:"li"},"urn:logto:organization:{organization_id}"),"."),(0,r.kt)("li",{parentName:"ul"},"For certain permissions (scopes), you need to check the ",(0,r.kt)("inlineCode",{parentName:"li"},"scope")," claim of the organization token by splitting the string with space as delimiter.")))}h.isMDXComponent=!0}}]);